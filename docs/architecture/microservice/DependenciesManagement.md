---
layout: default
title: Dependency Management
nav_order: 3
grand_parent: Architecture
parent: MicroService
---

마이크로 서비스와 같이 프로젝트가 여러개 되는 경우에는 필연적으로 코드의 중복을 줄이기 위해서 공통 모듈이 생기게 마련인데,

종속성 관계에 있는 패키지(프로젝트, 모듈 etc)를 어떻게 관리할 것 인가.

혹은 다른 성격의 프로젝트를 같은 리포지토리에서 관리할 것인가.

---
# 모노레포
여러 프로젝트를 하나의 리포지토리에 몰아서 관리할 수도 있을 것이다.

git 소스 관리 워크플로우에서 여러 프로젝트의 소스를 같이 관리하면, 머지할 때, 꼬이는 경우가 있을 수 있는거 같다.

특히 스테이징 환경이 없는 경우에 이런 상황을 겪을 수 있는거 같다(스테이징을 별도로 관리하고 통합테스트를 할 수 있는 리소스를 가지는 회사는 규모가 커야될거 같다는 생각이 든다.아니면, 체계화된 통합테스트 툴을 이용한다든지).

---
# 모노레포에서 모듈을 분리하는 필요성
모듈을 분리해서 관리해야 되는 이유는 관리를 용이하게 하기 위해서가 크다. 리포지토리의 브랜치 관리 전략도 연관이 있겠지만, 여러 담당자가 같은 리포지토리에 대해서 수정하는 경우, 확인하는 과정이 어려워진다. 확인하는 사람이 모든 이슈를 다 파악하기는 힘들지 않겠는가. 이런 관리상의 어려운 점은 운영상의 실수를 발생시킬 여지도 커지는 거 같다.

리포를 분리하면 브랜치관리가 용이해지고(소스 리뷰해야되는 범위가 줄어들고, 해당 소스에 연관이 있는 담당자가 볼 확률이 커진다) 소스관리에 실수를 할 가능성이 줄어든다. 만약에 개발 -> 실서버 배포간의 간격이 매우 큰 경우에 성격이 다른 여러 서비스의 코드가 있다면 확인은 매우 스트레스 일 것이다.

---
# 그렇다면 분리를 어떻게 할 것인가.


---
# 패키지로 분리하고 패키지를 통해서 관리하는 경우
프로젝트에서 패키지를 빌드하고, 패키지를 패키지 관리 서비스(Nexus나 github packages)로 관리할 수 있다.

* 확인이 필요한 사항
  + 라이브러리 빌드시에 resource 폴더 이하 파일이 없나?확실히 설정같은 경우는 config 서버로 관리했었는데...
    => 기존 패키지로 관리하는 프로젝트를 다시 한번 살펴 보자.



* 패키지로 분리하는 경우의 문제점
  + resources 폴더이하의 설정파일을 패키지를 사용하는 프로젝트에서 접근할 수 없다?
  + 패키지 업로드 권한이 Organization 인 경우 마스터계정만 되는거 같다? 말이 안되지만, 테스트해볼때는 그랬음.


---
# 서브모듈로 관리하는 방법

서브 모듈로 관리를 하게 되면, 메인 프로젝트에서 서브모듈의 커밋 해시코드를 가리키는 정보값이 모듈 수정시에 업데이트되는데 이것을 아래 옵션을 설정할 수 있다. 이렇게 설정하면 main 프로젝트에서 hash code가 업데이트 되지 않는다.

```
[diff]
    ignoreSubmodules = all
```

메인 프로젝트에서 서브 프로젝트의 해시코드를 어떻게 업데이트할지는 여전히 남아 있는데, 이 처리는 
Either https://github.com/renovatebot/renovate or https://dependabot.com/ would be really good for ensuring the submodules are always up to date.


